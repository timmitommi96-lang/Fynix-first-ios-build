/**
 * V1: Mehrsprachigkeit (DE, EN, ES) – zentrale Übersetzungen für die ganze App.
 * Nutzung: useT('key') oder useT('key.subkey')
 */

import { useApp } from './AppContext';
import type { AppLanguage } from './AppContext';

type NestedKeys<T, Prefix extends string = ''> = T extends object
  ? { [K in keyof T]: K extends string
    ? T[K] extends object
    ? NestedKeys<T[K], `${Prefix}${K}.`> | `${Prefix}${K}`
    : `${Prefix}${K}`
    : never }[keyof T] extends infer R
  ? R extends string
  ? R
  : never
  : never
  : never;

const translations: Record<AppLanguage, Record<string, string | Record<string, string>>> = {
  de: {
    profile: 'Profil',
    settings: 'Einstellungen',
    settingsDarkMode: 'Dark Mode',
    settingsLightMode: 'Light Mode',
    settingsLanguage: 'Sprache',
    settingsTheme: 'Akzentfarbe',
    themeYellow: 'Gelb',
    themeGreen: 'Grün',
    themeBlue: 'Blau',
    themePurple: 'Lila',
    themeRed: 'Rot',
    privacy: 'Privatsphäre',
    public: 'Öffentlich',
    private: 'Privat',
    logout: 'Abmelden',
    levelRoadmap: 'Level-Roadmap',
    progress: 'Fortschritt',
    totalXP: 'Total XP',
    streak: 'Streak',
    sessions: 'Sessions',
    roastLevel: 'Roast-Level',
    vocab: 'Vokabeln',
    vocabCollection: 'Vokabelsammlung',
    vocabAdd: 'Hinzufügen',
    vocabScan: 'KI scannen',
    vocabQuiz: 'Vokabelquiz',
    vocabQuizStart: 'Quiz starten',
    vocabListCreate: 'Erstellen',
    vocabListSelect: 'Liste wählen',
    vocabScanning: 'Scan läuft...',
    vocabOpen: 'Öffnen',
    home: 'Home',
    feed: 'Feed',
    feedStart: 'Feed starten',
    habits: 'Habits',
    money: 'Money',
    joker: 'Joker',
    chests: 'Truhen',
    back: 'Zurück',
    close: 'Schließen',
    save: 'Speichern',
    edit: 'Bearbeiten',
    delete: 'Löschen',
    aiUrlLabel: 'Lokale KI URL (Ollama)',
    correct: 'Richtig!',
    wrong: 'Falsch',
    nextCard: 'Nächste Karte',
    swipeForQuiz: 'Swipe für Quiz',
    quizTime: 'Quiz Time!',
    tipOfDay: 'Tipp des Tages',
    tipOfDayText: 'Lerne in 25-Minuten-Blöcken. Dein Gehirn dankt es dir!',
    vocabEntries: 'Einträge',
    noVocabInList: 'Noch keine Vokabeln in dieser Liste.',
    noLists: 'Noch keine Listen vorhanden.',
    multipleChoice: 'Multiple Choice',
    inputMode: 'Eingabe',
    mixed: 'Gemischt',
    question: 'Frage',
    score: 'Score',
    quizFinished: 'Quiz beendet',
    vocabFeedbackCorrectMild: 'Kein Problem, passiert den Besten!',
    vocabFeedbackCorrectMedium: 'Stabil! Weiter so.',
    vocabFeedbackCorrectHard: 'Okay, das ging klar.',
    vocabFeedbackWrongMild: 'Fast! Beim nächsten Mal klappt\'s.',
    vocabFeedbackWrongMedium: 'Das war knapp daneben.',
    vocabFeedbackWrongHard: 'Haha, du wusstest nicht, was "{term}" heißt!',
  },
  en: {
    profile: 'Profile',
    settings: 'Settings',
    settingsDarkMode: 'Dark Mode',
    settingsLightMode: 'Light Mode',
    settingsLanguage: 'Language',
    settingsTheme: 'Accent color',
    themeYellow: 'Yellow',
    themeGreen: 'Green',
    themeBlue: 'Blue',
    themePurple: 'Purple',
    themeRed: 'Red',
    privacy: 'Privacy',
    public: 'Public',
    private: 'Private',
    logout: 'Log out',
    levelRoadmap: 'Level roadmap',
    progress: 'Progress',
    totalXP: 'Total XP',
    streak: 'Streak',
    sessions: 'Sessions',
    roastLevel: 'Roast level',
    vocab: 'Vocabulary',
    vocabCollection: 'Vocabulary collection',
    vocabAdd: 'Add',
    vocabScan: 'AI scan',
    vocabQuiz: 'Vocabulary quiz',
    vocabQuizStart: 'Start quiz',
    vocabListCreate: 'Create',
    vocabListSelect: 'Select list',
    vocabScanning: 'Scanning...',
    vocabOpen: 'Open',
    home: 'Home',
    feed: 'Feed',
    feedStart: 'Start feed',
    habits: 'Habits',
    money: 'Money',
    joker: 'Joker',
    chests: 'Chests',
    back: 'Back',
    close: 'Close',
    save: 'Save',
    edit: 'Edit',
    delete: 'Delete',
    aiUrlLabel: 'Local AI URL (Ollama)',
    correct: 'Correct!',
    wrong: 'Wrong',
    nextCard: 'Next card',
    swipeForQuiz: 'Swipe for quiz',
    quizTime: 'Quiz time!',
    tipOfDay: 'Tip of the day',
    tipOfDayText: 'Study in 25-minute blocks. Your brain will thank you!',
    vocabEntries: 'Entries',
    noVocabInList: 'No vocabulary in this list yet.',
    noLists: 'No lists yet.',
    multipleChoice: 'Multiple choice',
    inputMode: 'Input',
    mixed: 'Mixed',
    question: 'Question',
    score: 'Score',
    quizFinished: 'Quiz finished',
    vocabFeedbackCorrectMild: 'No problem, happens to the best!',
    vocabFeedbackCorrectMedium: 'Solid! Keep it up.',
    vocabFeedbackCorrectHard: 'Okay, that was clear.',
    vocabFeedbackWrongMild: 'Almost! Next time.',
    vocabFeedbackWrongMedium: 'That was close.',
    vocabFeedbackWrongHard: 'Haha, you didn\'t know what "{term}" means!',
  },
  es: {
    profile: 'Perfil',
    settings: 'Ajustes',
    settingsDarkMode: 'Modo oscuro',
    settingsLightMode: 'Modo claro',
    settingsLanguage: 'Idioma',
    settingsTheme: 'Color de acento',
    themeYellow: 'Amarillo',
    themeGreen: 'Verde',
    themeBlue: 'Azul',
    themePurple: 'Morado',
    themeRed: 'Rojo',
    privacy: 'Privacidad',
    public: 'Público',
    private: 'Privado',
    logout: 'Cerrar sesión',
    levelRoadmap: 'Mapa de nivel',
    progress: 'Progreso',
    totalXP: 'XP total',
    streak: 'Racha',
    sessions: 'Sesiones',
    roastLevel: 'Nivel de roast',
    vocab: 'Vocabulario',
    vocabCollection: 'Colección de vocabulario',
    vocabAdd: 'Añadir',
    vocabScan: 'Escanear con IA',
    vocabQuiz: 'Quiz de vocabulario',
    vocabQuizStart: 'Empezar quiz',
    vocabListCreate: 'Crear',
    vocabListSelect: 'Elegir lista',
    vocabScanning: 'Escaneando...',
    vocabOpen: 'Abrir',
    home: 'Inicio',
    feed: 'Feed',
    feedStart: 'Iniciar feed',
    habits: 'Habitos',
    money: 'Dinero',
    joker: 'Comodín',
    chests: 'Cofres',
    back: 'Atrás',
    close: 'Cerrar',
    save: 'Guardar',
    edit: 'Editar',
    delete: 'Eliminar',
    aiUrlLabel: 'URL de IA local (Ollama)',
    correct: '¡Correcto!',
    wrong: 'Incorrecto',
    nextCard: 'Siguiente carta',
    swipeForQuiz: 'Desliza para quiz',
    quizTime: '¡Hora del quiz!',
    tipOfDay: 'Consejo del día',
    tipOfDayText: 'Estudia en bloques de 25 minutos. ¡Tu cerebro te lo agradecerá!',
    vocabEntries: 'Entradas',
    noVocabInList: 'Aún no hay vocabulario en esta lista.',
    noLists: 'Aún no hay listas.',
    multipleChoice: 'Opción múltiple',
    inputMode: 'Entrada',
    mixed: 'Mixto',
    question: 'Pregunta',
    score: 'Puntuación',
    quizFinished: 'Quiz terminado',
    vocabFeedbackCorrectMild: 'No pasa nada, les pasa a los mejores.',
    vocabFeedbackCorrectMedium: '¡Bien! Sigue así.',
    vocabFeedbackCorrectHard: 'Vale, eso estaba claro.',
    vocabFeedbackWrongMild: '¡Casi! La próxima vez.',
    vocabFeedbackWrongMedium: 'Has estado cerca.',
    vocabFeedbackWrongHard: '¡Jaja, no sabías qué significa "{term}"!',
  },
};

function getTranslation(lang: AppLanguage, key: string, params?: Record<string, string>): string {
  const parts = key.split('.');
  let value: unknown = translations[lang];
  for (const p of parts) {
    value = value && typeof value === 'object' && p in value ? (value as Record<string, unknown>)[p] : undefined;
  }
  let text = typeof value === 'string' ? value : key;
  if (params) {
    Object.entries(params).forEach(([k, v]) => {
      text = text.replace(new RegExp(`\\{${k}\\}`, 'g'), v);
    });
  }
  return text;
}

/** V1: Hook für übersetzte Strings (reagiert auf Sprachwechsel) */
export function useT(key: string, params?: Record<string, string>): string {
  const { preferences } = useApp();
  return getTranslation(preferences.language, key, params);
}

export { getTranslation };
